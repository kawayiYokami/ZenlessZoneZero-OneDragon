name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      create_release:
        description: 'Create Release'
        required: true
        default: false
        type: boolean

env:
  CREATE_RELEASE: ${{ (github.event_name == 'workflow_dispatch' && inputs.create_release == true) || startsWith(github.ref, 'refs/tags/') }}

jobs:
  build:
    runs-on: windows-latest
    outputs:
      version: ${{ steps.get_version.outputs.version }}
      tag: ${{ steps.get_version.outputs.tag }}
      unsigned_artifact_id: ${{ steps.upload-unsigned-artifact.outputs.artifact-id }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: Get version
      id: get_version
      shell: pwsh
      run: |
        if ($env:GITHUB_REF -like 'refs/tags/*') {
          # å·²ç”± tag æ¨é€è§¦å‘ï¼Œç›´æ¥ä½¿ç”¨è¯¥ tag ä½œä¸ºç‰ˆæœ¬
          $version = $env:GITHUB_REF.Substring(10)
          $tag = $version
        } else {
          # æ‰‹åŠ¨ workflow_dispatch è§¦å‘ï¼šä½¿ç”¨ git çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬æ’åºï¼Œé€‰å‡ºæœ€æ–° tagï¼Œç„¶åç”Ÿæˆ / é€’å¢ beta ç‰ˆæœ¬
          # --refs å¯é¿å…å‡ºç°å¸¦ ^{} çš„ peeled è¡Œï¼Œ--sort=-version:refname ä»¥ç‰ˆæœ¬åå€’åºæ’åºï¼Œ'v*' ä»…åŒ¹é…è¯­ä¹‰åŒ–ç‰ˆæœ¬å‰ç¼€
          $latestRef = git ls-remote --refs --tags --sort=-version:refname origin 'v*' |
            Where-Object { $_ -match 'refs/tags/(v\d+\.\d+\.\d+(?:-beta\.\d+)?)$' } |
            Select-Object -First 1

          if (-not $latestRef) {
            # ä»“åº“è¿˜æ²¡æœ‰ä»»ä½•ç¬¦åˆè¯­ä¹‰ç‰ˆæœ¬çš„ tagï¼Œåˆå§‹åŒ–ä¸º v0.1.0-beta.1
            $baseVersion = 'v0.1.0'
            $betaNumber = 1
            $tag = "$baseVersion-beta.$betaNumber"
          } else {
            # è¡Œæ ¼å¼: <hash>\trefs/tags/<tagname>
            if ($latestRef -match 'refs/tags/(.+)$') {
              $latestTag = $matches[1]
            } else {
              throw "æ— æ³•ä» ls-remote è¾“å‡ºä¸­è§£ææœ€æ–° tagï¼š$latestRef"
            }

            if ($latestTag -match '^(v\d+\.\d+\.\d+)-beta\.(\d+)$') {
              # æœ€æ–°å³ä¸º betaï¼Œç›´æ¥åœ¨ beta ç¼–å·ä¸Š +1
              $baseVersion = $matches[1]
              $betaNumber = [int]$matches[2] + 1
              $tag = "$baseVersion-beta.$betaNumber"
            } else {
              # æœ€æ–°ä¸ºç¨³å®šç‰ˆæœ¬ï¼Œä»è¯¥ç¨³å®šç‰ˆæœ¬å¼€å§‹æ–°çš„ beta åºåˆ—
              $latestTag -match '^(v\d+\.\d+\.)(\d+)$'
              $baseVersion = $matches[1] + ([int]$matches[2] + 1)
              $betaNumber = 1
              $tag = "$baseVersion-beta.$betaNumber"
            }
          }

          $version = $tag

          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          # åˆ›å»ºå¹¶æ¨é€æ–° beta tag
          git tag $tag
          git push origin $tag
        }

        echo "version=$version" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
        echo "tag=$tag" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
        echo "__version__ = '$version'" | Out-File -FilePath src/one_dragon/version.py -Encoding utf8

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11.9'

    - name: Install uv
      shell: pwsh
      run: |
        Invoke-WebRequest -Uri https://astral.sh/uv/install.ps1 | Invoke-Expression

    - name: Create and activate virtual environment
      shell: pwsh
      run: |
        uv venv .venv --python=3.11.12

    - name: Install dependencies
      shell: pwsh
      run: |
        .\.venv\Scripts\Activate.ps1
        uv sync --group dev

    - name: Download and extract UPX into venv Scripts
      shell: pwsh
      run: |
        $venvScripts = ".\.venv\Scripts"
        $upxDir = Join-Path $venvScripts "upx"
        $sourceUpxPath = Join-Path $upxDir "upx-4.2.3-win64" "upx.exe"
        $destinationUpxPath = Join-Path $venvScripts "upx.exe"
        $zipPath = "upx.zip"

        Invoke-WebRequest -Uri "https://github.com/upx/upx/releases/download/v4.2.3/upx-4.2.3-win64.zip" -OutFile $zipPath
        Expand-Archive -Path $zipPath -DestinationPath $upxDir -Force
        Move-Item -Path $sourceUpxPath -Destination $destinationUpxPath -Force
        Remove-Item -Path $upxDir -Recurse -Force
        Remove-Item -Path $zipPath -Force

    - name: Build executables
      shell: pwsh
      run: |
        .\.venv\Scripts\Activate.ps1
        cd deploy
        pyinstaller "OneDragon-Installer.spec"
        pyinstaller "OneDragon-Launcher.spec"

    - name: Bundle dependencies into wheels
      shell: pwsh
      run: |
        # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
        .\.venv\Scripts\Activate.ps1

        # åˆ›å»ºç›®æ ‡ç›®å½•å¹¶ç”Ÿæˆ wheel åŒ…
        New-Item -ItemType Directory -Path deploy/dist/wheels -Force
        uv export --no-hashes --no-dev --format requirements-txt > deploy/dist/requirements.txt
        pip wheel --wheel-dir=deploy/dist/wheels -r deploy/dist/requirements.txt

        # å‹ç¼©ç”Ÿæˆçš„ wheels ç›®å½•
        Compress-Archive -Path deploy/dist/wheels/* -DestinationPath deploy/dist/ZenlessZoneZero-OneDragon-Environment.zip

    - name: Upload Installer
      if: ${{ env.CREATE_RELEASE == 'false' }}
      uses: actions/upload-artifact@v4
      with:
        name: Installer
        path: deploy/dist/OneDragon-Installer.exe

    - name: Upload Launcher
      if: ${{ env.CREATE_RELEASE == 'false' }}
      uses: actions/upload-artifact@v4
      with:
        name: Launcher
        path: deploy/dist/OneDragon-Launcher.exe

    - name: Upload Wheels
      if: ${{ env.CREATE_RELEASE == 'false' }}
      uses: actions/upload-artifact@v4
      with:
        name: Wheels
        path: deploy/dist/ZenlessZoneZero-OneDragon-Environment.zip

    - name: Upload Dist
      if: ${{ env.CREATE_RELEASE == 'true' }}
      uses: actions/upload-artifact@v4
      with:
        name: dist
        if-no-files-found: error
        path: deploy/dist

    - name: Upload Unsigned Artifact
      if: ${{ env.CREATE_RELEASE == 'true' }}
      id: upload-unsigned-artifact
      uses: actions/upload-artifact@v4
      with:
        # ä¸Šä¼ åæ˜¯ unsigned.zip
        name: unsigned
        if-no-files-found: error
        path: |
          .\deploy\dist\OneDragon-Launcher.exe
          .\deploy\dist\OneDragon-Installer.exe

  sign:
    runs-on: windows-latest
    needs: build
    if: ${{ (github.event_name == 'workflow_dispatch' && inputs.create_release == true) || startsWith(github.ref, 'refs/tags/') }}
    env:
      SIGNED_DIR: 'signed'
      SIGNPATH_SIGNING_POLICY_SLUG: 'release-signing'
    steps:
    - name: Sign Artifact
      if: ${{ needs.build.outputs.unsigned_artifact_id != '' }}
      uses: signpath/github-action-submit-signing-request@v1.1
      with:
        api-token: '${{ secrets.SIGNPATH_API_TOKEN }}'
        organization-id: '${{ vars.SIGNPATH_ORGANIZATION_ID }}'
        project-slug: 'ZenlessZoneZero-OneDragon'
        signing-policy-slug: '${{ env.SIGNPATH_SIGNING_POLICY_SLUG }}'
        github-artifact-id: "${{ needs.build.outputs.unsigned_artifact_id }}"
        wait-for-completion: true
        # ç­¾ååä¼šè‡ªåŠ¨ä¸‹è½½åˆ°è¿™ä¸ªç›®å½•å¹¶è§£å‹ æ–‡ä»¶åå’ŒåŸæ¥çš„ä¸€æ ·
        output-artifact-directory: '${{ env.SIGNED_DIR }}'

    - name: Upload signed executables
      uses: actions/upload-artifact@v4
      with:
        name: signed
        if-no-files-found: error
        path: ${{ env.SIGNED_DIR }}

  release:
    runs-on: windows-latest
    needs:
      - build
      - sign
    if: ${{ ((github.event_name == 'workflow_dispatch' && inputs.create_release == true) || startsWith(github.ref, 'refs/tags/')) && needs.sign.result == 'success' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: Download dist
      uses: actions/download-artifact@v4
      with:
        name: dist
        path: deploy/dist

    - name: Download signed executables
      if: ${{ needs.sign.result == 'success' }}
      uses: actions/download-artifact@v4
      with:
        name: signed
        path: deploy/dist/signed

    - name: Replace unsigned executables with signed ones
      if: ${{ needs.sign.result == 'success' }}
      shell: pwsh
      run: |
        Copy-Item "deploy/dist/signed/OneDragon-Installer.exe" -Destination "deploy/dist/OneDragon-Installer.exe" -Force
        Copy-Item "deploy/dist/signed/OneDragon-Launcher.exe" -Destination "deploy/dist/OneDragon-Launcher.exe" -Force

    - name: Prepare release directory and models
      shell: pwsh
      env:
        RELEASE_VERSION: ${{ needs.build.outputs.version }}
      run: |
        # å°† dist ç§»åŠ¨åˆ°å½“å‰ç›®å½•çš„çˆ¶ç›®å½•ä¸‹
        $distDir = "deploy/dist"
        $parentDir = Split-Path -Path (Get-Location) -Parent
        $targetDist = Join-Path $parentDir "dist"

        Move-Item -Path $distDir -Destination $targetDist -Force
        $distDir = $targetDist
        $envDir = ".install"
        New-Item -ItemType Directory -Path $envDir -Force | Out-Null

        # å‡†å¤‡ç¦»çº¿è¿è¡Œæ‰€éœ€çš„ .install èµ„æº
        Invoke-WebRequest -Uri "https://github.com/OneDragon-Anything/OneDragon-Env/releases/download/ZenlessZoneZero-OneDragon/uv-x86_64-pc-windows-msvc.zip" -OutFile "$envDir/uv-x86_64-pc-windows-msvc.zip"
        Invoke-WebRequest -Uri "https://github.com/OneDragon-Anything/OneDragon-Env/releases/download/ZenlessZoneZero-OneDragon/MinGit.zip" -OutFile "$envDir/MinGit.zip"
        Invoke-WebRequest -Uri "https://github.com/OneDragon-Anything/OneDragon-Env/releases/download/ZenlessZoneZero-OneDragon/cpython-3.11.zip" -OutFile "$envDir/cpython-3.11.zip"

        # å°†å®‰è£…å™¨å¤åˆ¶åˆ°ä»“åº“æ ¹ç›®å½•
        Copy-Item "$distDir/OneDragon-Installer.exe" -Destination "OneDragon-Installer.exe" -Force

        # æ‰“åŒ…å¯åŠ¨å™¨
        Compress-Archive -Path "$distDir/OneDragon-Launcher.exe" -DestinationPath "$distDir/ZenlessZoneZero-OneDragon-Launcher.zip" -Force
        Copy-Item "$distDir/OneDragon-Launcher.exe" -Destination "OneDragon-Launcher.exe" -Force

        # æ¨¡å‹ç›®å½•ï¼ˆæ”¾åœ¨ä»“åº“æ ¹ assets/models ä¸‹ï¼‰
        $modelBase = "assets/models"
        New-Item -ItemType Directory -Path "$modelBase/onnx_ocr" -Force | Out-Null
        New-Item -ItemType Directory -Path "$modelBase/flash_classifier" -Force | Out-Null
        New-Item -ItemType Directory -Path "$modelBase/hollow_zero_event" -Force | Out-Null
        New-Item -ItemType Directory -Path "$modelBase/lost_void_det" -Force | Out-Null

        # ä¸´æ—¶æ¨¡å‹ç›®å½•
        $tempDir = "temp_models"
        New-Item -ItemType Directory -Path $tempDir -Force

        # é€šè¿‡æ–‡ä»¶æœ«å°¾æœ€é«˜8ä½æ•°å­—è·å–æœ€æ–°æ¨¡å‹
        function Get-LatestModelByNumber {
          param (
            [string]$repo,
            [string]$pattern
          )
          $apiUrl = "https://api.github.com/repos/$repo/releases"
          $releases = Invoke-RestMethod -Uri $apiUrl -Headers @{ "Accept" = "application/vnd.github.v3+json" }

          $bestAsset = $null
            $maxNumber = -1

          foreach ($release in $releases) {
            foreach ($asset in $release.assets) {
              if ($asset.name -match $pattern) {
                # ä»æ–‡ä»¶åæœ«å°¾æå–8ä½æ•°å­—ï¼ˆåœ¨.zipä¹‹å‰ï¼‰
                if ($asset.name -match '(\d{8})\.zip$') {
                  $number = [int]$matches[1]
                  if ($number -gt $maxNumber) {
                    $maxNumber = $number
                    $bestAsset = @{
                      url = $asset.browser_download_url
                      name = $asset.name
                      version_number = $number
                    }
                  }
                }
                # å¯¹äºppocrv5å’Œå…¶ä»–æ²¡æœ‰8ä½æ•°å­—åç¼€çš„æ¨¡å‹ï¼Œä½œä¸ºå¤‡ç”¨é€‰é¡¹
                elseif ($bestAsset -eq $null) {
                  $bestAsset = @{
                    url = $asset.browser_download_url
                    name = $asset.name
                    version_number = 0
                  }
                }
              }
            }
          }
          return $bestAsset
        }

        function Expand-ZipIntoNamedFolder {
          param (
            [string]$url,
            [string]$downloadPath,
            [string]$destRoot,
            [string]$folderName
          )
          Invoke-WebRequest -Uri $url -OutFile $downloadPath
          $targetPath = Join-Path $destRoot $folderName
          New-Item -ItemType Directory -Path $targetPath -Force
          Expand-Archive -Path $downloadPath -DestinationPath $targetPath -Force
        }

        # è·å– ppocrv5 æ¨¡å‹ (onnx_ocr)
        $ppocrModel = Get-LatestModelByNumber -repo "OneDragon-Anything/OneDragon-Env" -pattern "ppocrv5\.zip$"
        if ($ppocrModel) {
          $ppocrName = $ppocrModel.name -replace "\.zip$", ""
          Write-Host "æ‰¾åˆ° ppocrv5 æ¨¡å‹: $($ppocrModel.name) (ç‰ˆæœ¬: $($ppocrModel.version_number))"
          Expand-ZipIntoNamedFolder `
            -url $ppocrModel.url `
            -downloadPath "$tempDir/ppocrv5.zip" `
            -destRoot "$modelBase/onnx_ocr" `
            -folderName $ppocrName
        } else {
          Write-Warning "æ— æ³•æ‰¾åˆ° ppocrv5 æ¨¡å‹ï¼Œä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬"
          Expand-ZipIntoNamedFolder `
            -url "https://github.com/OneDragon-Anything/OneDragon-Env/releases/download/ppocrv5/ppocrv5.zip" `
            -downloadPath "$tempDir/ppocrv5.zip" `
            -destRoot "$modelBase/onnx_ocr" `
            -folderName "ppocrv5"
        }

        # è·å– flash classifier æ¨¡å‹
        $flashModel = Get-LatestModelByNumber -repo "OneDragon-Anything/OneDragon-YOLO" -pattern "flash.*\.zip$"
        if ($flashModel) {
          $flashName = $flashModel.name -replace "\.zip$", ""
          Write-Host "æ‰¾åˆ° flash æ¨¡å‹: $($flashModel.name) (ç‰ˆæœ¬: $($flashModel.version_number))"
          Expand-ZipIntoNamedFolder `
            -url $flashModel.url `
            -downloadPath "$tempDir/flash.zip" `
            -destRoot "$modelBase/flash_classifier" `
            -folderName $flashName
        } else {
          Write-Warning "æ— æ³•æ‰¾åˆ° flash æ¨¡å‹ï¼Œä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬"
          Expand-ZipIntoNamedFolder `
            -url "https://github.com/OneDragon-Anything/OneDragon-YOLO/releases/download/zzz_model/yolov8n-640-flash-0127.zip" `
            -downloadPath "$tempDir/flash.zip" `
            -destRoot "$modelBase/flash_classifier" `
            -folderName "yolov8n-640-flash-0127"
        }

        # è·å– hollow zero event æ¨¡å‹
        $hollowModel = Get-LatestModelByNumber -repo "OneDragon-Anything/OneDragon-YOLO" -pattern "hollow.*\.zip$"
        if ($hollowModel) {
          $hollowName = $hollowModel.name -replace "\.zip$", ""
          Write-Host "æ‰¾åˆ° hollow æ¨¡å‹: $($hollowModel.name) (ç‰ˆæœ¬: $($hollowModel.version_number))"
          Expand-ZipIntoNamedFolder `
            -url $hollowModel.url `
            -downloadPath "$tempDir/hollow.zip" `
            -destRoot "$modelBase/hollow_zero_event" `
            -folderName $hollowName
        } else {
          Write-Warning "æ— æ³•æ‰¾åˆ° hollow æ¨¡å‹ï¼Œä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬"
          Expand-ZipIntoNamedFolder `
            -url "https://github.com/OneDragon-Anything/OneDragon-YOLO/releases/download/zzz_model/yolov8s-736-hollow-zero-event-0126.zip" `
            -downloadPath "$tempDir/hollow.zip" `
            -destRoot "$modelBase/hollow_zero_event" `
            -folderName "yolov8s-736-hollow-zero-event-0126"
        }

        # è·å– lost void detection æ¨¡å‹
        $lostModel = Get-LatestModelByNumber -repo "OneDragon-Anything/OneDragon-YOLO" -pattern "lost.*\.zip$"
        if ($lostModel) {
          $lostName = $lostModel.name -replace "\.zip$", ""
          Write-Host "æ‰¾åˆ° lost void æ¨¡å‹: $($lostModel.name) (ç‰ˆæœ¬: $($lostModel.version_number))"
          Expand-ZipIntoNamedFolder `
            -url $lostModel.url `
            -downloadPath "$tempDir/lost.zip" `
            -destRoot "$modelBase/lost_void_det" `
            -folderName $lostName
        } else {
          Write-Warning "æ— æ³•æ‰¾åˆ° lost void æ¨¡å‹ï¼Œä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬"
          Expand-ZipIntoNamedFolder `
            -url "https://github.com/OneDragon-Anything/OneDragon-YOLO/releases/download/zzz_model/yolov8n-736-lost-void-det-20250612.zip" `
            -downloadPath "$tempDir/lost.zip" `
            -destRoot "$modelBase/lost_void_det" `
            -folderName "yolov8n-736-lost-void-det-20250612"
        }

        # è·å–ç‰ˆæœ¬å·
        $version = $env:RELEASE_VERSION

        # æ‰“åŒ…å‰åˆ é™¤ä¸éœ€è¦çš„ç›®å½•
        Remove-Item -Path "deploy/build" -Recurse -Force -ErrorAction SilentlyContinue
        Remove-Item -Path ".venv" -Recurse -Force -ErrorAction SilentlyContinue
        Remove-Item -Path ".install/uv_cache" -Recurse -Force -ErrorAction SilentlyContinue
        git reset --hard HEAD
        git clean -fd | Out-Null

        # ç¬¬ä¸€æ¬¡æ‰“åŒ…ï¼ˆFullï¼‰æšä¸¾æ ¹ç›®å½•å…¨éƒ¨é¡¹ç›®
        $items = Get-ChildItem -Force | ForEach-Object { $_.FullName }
        Compress-Archive -Path $items -DestinationPath "$distDir/ZenlessZoneZero-OneDragon-$version-Full.zip" -Force

        # å°†ç¯å¢ƒä¾èµ–åŒ…æ”¾å…¥ .install åè¿›è¡Œç¬¬äºŒæ¬¡æ‰“åŒ…ï¼ˆFull-Environmentï¼‰
        Copy-Item "$distDir/ZenlessZoneZero-OneDragon-Environment.zip" -Destination "$envDir/ZenlessZoneZero-OneDragon-Environment.zip" -Force
        $items = Get-ChildItem -Force | ForEach-Object { $_.FullName }
        Compress-Archive -Path $items -DestinationPath "$distDir/ZenlessZoneZero-OneDragon-$version-Full-Environment.zip" -Force

        # å¤åˆ¶å®‰è£…å™¨
        Copy-Item "OneDragon-Installer.exe" -Destination "ZenlessZoneZero-OneDragon-$version-Installer.exe" -Force

        # å°†æ‰€æœ‰å¾…å‘å¸ƒæ–‡ä»¶ç§»åˆ°å½“å‰ç›®å½•
        Move-Item -Path "$distDir/*.zip" -Destination (Get-Location) -Force

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ needs.build.outputs.tag }}
        name: "Release ${{ needs.build.outputs.version }}"
        body: |
          # å®‰è£…æ–¹å¼

          - `ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Full-Environment.zip` ä¸ºå¸¦ç¯å¢ƒçš„å®Œæ•´åŒ…ï¼Œä¸éœ€è¦é¢å¤–ä¸‹è½½èµ„æºã€‚
          - `ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Full.zip` ä¸ºå®Œæ•´åŒ…ï¼Œè§£å‹åé€‰æ‹©è§£å‹ç›®å½•ä¸ºå®‰è£…ç›®å½•ï¼Œåªéœ€è¦ä¸‹è½½ç¯å¢ƒä¾èµ–ã€‚
          - `ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Installer.exe` ä¸ºç²¾ç®€å®‰è£…ç¨‹åºï¼Œè¿è¡Œåä¼šè‡ªåŠ¨ä¸‹è½½æ‰€éœ€çš„èµ„æºã€‚
          - å¦‚æœä½ æƒ³æ›´æ–°å¯åŠ¨å™¨ï¼Œå‰å¾€ä¸»ç¨‹åºã€è®¾ç½®ã€‘-ã€èµ„æºä¸‹è½½ã€‘é¡µé¢æ›´æ–°ï¼Œæˆ–è€…ä¸‹è½½ `ZenlessZoneZero-OneDragon-Launcher.zip`ï¼Œè§£å‹åæ›¿æ¢ã€‚
          - __ä¸è¦ä¸‹è½½Source Code__

          å®‰è£…å‰è¯·æŸ¥çœ‹ [å®‰è£…æŒ‡å—](https://one-dragon.com/zzz/zh/quickstart.html)
          è‹¥è¿è¡Œå‡ºé”™è¯·æŸ¥çœ‹ [è‡ªåŠ©æ’éšœæŒ‡å—](https://docs.qq.com/doc/p/7add96a4600d363b75d2df83bb2635a7c6a969b5)

          å·²æœ‰ Mirroré…± CDKï¼Ÿå‰å¾€ [Mirroré…±](https://mirrorchyan.com/zh/projects?rid=ZZZ-OneDragon&source=zzzgh-release) é«˜é€Ÿä¸‹è½½

          ## ğŸ“ ç­¾åç­–ç•¥ (Code Signing Policy)

          å…è´¹ä»£ç ç­¾åç”± [SignPath.io](https://signpath.io/) æä¾›ï¼Œè¯ä¹¦ç”± [SignPath Foundation](https://signpath.org/) é¢å‘

          å®¡æ‰¹äººï¼š[DoctorReid](https://github.com/DoctorReid) [ShadowLemoon](https://github.com/ShadowLemoon)

          Free code signing provided by [SignPath.io](https://signpath.io/), certificate by [SignPath Foundation](https://signpath.org/)

          Approvers: [DoctorReid](https://github.com/DoctorReid) [ShadowLemoon](https://github.com/ShadowLemoon)

          ## ğŸ”’ éšç§æ”¿ç­– (Privacy Policy)

          æœ¬ç¨‹åºçš„éšç§æ”¿ç­–è¯¦è§ï¼š[éšç§æ”¿ç­–](.github/PRIVACY.md)ã€‚

          See the [Privacy Policy](.github/PRIVACY.md). unless specifically requested by the user or the person installing or operating it.

        files: |
          ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Full-Environment.zip
          ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Full.zip
          ZenlessZoneZero-OneDragon-${{ needs.build.outputs.version }}-Installer.exe
          ZenlessZoneZero-OneDragon-Environment.zip
          ZenlessZoneZero-OneDragon-Launcher.zip
        generate_release_notes: false
        prerelease: ${{ contains(needs.build.outputs.version, '-beta.') }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
