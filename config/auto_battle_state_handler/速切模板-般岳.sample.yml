template_name: "速切模板-般岳"
# 般岳速切模板 - 基于操作指南重构
# ============================================
# 核心机制：
# - 嗔火(Wrathful Fires)：最大150点，≥120可进入怒相状态
# - 山威(Mountain's Might)：进入怒相获得4点，EX技能消耗山威而非能量
# - 怒相状态下无法获得嗔火！
# ============================================
# 速切策略：
# - 快速积攒嗔火，等待失衡期再进入怒相爆发
# - 完整循环：ABA→BBA→BAB→AAB，消耗120能量，积攒60嗔火
# - 怒相爆发：ABA→BBA→BAB→AAB→长按A(摧岳+倾山)，总倍率4582.8%
# ============================================
# 资源管理要点：
# - 怒相中无法获取嗔火，注意进入时机
# - 失衡窗口是核心输出期，确保有足够资源
# - 开局可用引火直接获得120嗔火（消耗HP，一局一次）
# ============================================
handlers:
  - states: "[前台-般岳]"
    interrupt_states: "[前台-能量, 0, 0.1] & ![前台-般岳]"
    sub_handlers:
      # ==================== 清除其他异常状态 ====================
      - states: "[自定义-异常-电, 0, 99] | [自定义-异常-冰, 0, 99] | [自定义-异常-物理, 0, 99] | [自定义-异常-以太, 0, 99]"
        debug_name: "清除其他异常积蓄"
        operations:
          - op_name: "清除状态"
            state_list: ["自定义-异常-电", "自定义-异常-冰", "自定义-异常-物理", "自定义-异常-以太"]

      # ==================== 黄光处理 ====================
      - states: "[自定义-黄光切人, 0, 1]"
        sub_handlers:
          # 有山威时：不动如山格挡，不切人继续站场
          - states: "[般岳-山威]{1, 4}"
            debug_name: "有山威黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 怒相状态下：不动如山格挡，继续站场输出
          - states: "[自定义-般岳-怒相, 0, 30]"
            debug_name: "怒相状态黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 嗔火满时：不动如山格挡，准备进入怒相
          - states: "[般岳-嗔火]{120, 150}"
            debug_name: "嗔火满黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 嗔火未满且无山威：正常切人招架支援
          - states: ""
            debug_name: "嗔火未满正常切人招架支援"
            operations:
              - operation_template: "般岳-招架支援-铁壁"

      # ==================== 红光闪避 ====================
      - states: "[自定义-红光闪避, 0, 1]"
        sub_handlers:
          # 有山威时：不动如山格挡
          - states: "[般岳-山威]{1, 4}"
            debug_name: "有山威红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 怒相状态下：不动如山格挡
          - states: "[自定义-般岳-怒相, 0, 30]"
            debug_name: "怒相状态红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 嗔火满时：不动如山格挡
          - states: "[般岳-嗔火]{120, 150}"
            debug_name: "嗔火满红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 嗔火未满：闪避反击扬砾
          - states: ""
            debug_name: "扬砾闪避反击"
            operations:
              - operation_template: "般岳-闪避反击-扬砾"

      # ==================== 连携换人 ====================
      - states: "[自定义-连携换人, 0, 0.5]"
        operations:
          - operation_template: "般岳-连携技-怒焰"

      # ==================== 切人后等待 ====================
      - states: "([按键-切换角色-下一个, 0, 0.3]|[按键-切换角色-上一个, 0, 0.3])"
        debug_name: "切人后等待"
        sub_handlers:
          - states: "[按键可用-快速支援, 0, 0.5]"
            operations:
              - op_name: "等待秒数"
                seconds: 0.5
          - states: ""
            operations:
              - op_name: "等待秒数"
                seconds: 0.3

      # ==================== 失衡期终结技 ====================
      # 失衡期间释放终结技（嗔火≥120时自动进入怒相）
      # 速切模板：非怒相状态下才释放终结技
      - states: "[自定义-失衡时间, 0, 10] & [般岳-终结技可用] & ![自定义-般岳-怒相, 0, 30]"
        debug_name: "失衡期释放撼天动地"
        operations:
          - operation_template: "般岳-终结技-撼天动地"
          - op_name: "设置状态"
            state_list: ["自定义-合轴时间", "自定义-般岳-怒相"]

      # ==================== 怒相爆发 ====================
      # 怒相状态下释放4EX+摧岳+倾山（搓招版）
      - states: "[自定义-般岳-怒相, 0, 30]"
        debug_name: "怒相爆发连招"
        operations:
          - operation_template: "般岳-连招-怒相爆发"

      # ==================== 进入怒相 ====================
      # 速切模板：嗔火满时等待失衡期再进入怒相，最大化输出
      # 如果失衡期且嗔火满，优先进入怒相
      - states: "[自定义-失衡时间, 0, 10] & [般岳-嗔火]{120, 150}"
        debug_name: "失衡期嗔火满进入怒相"
        operations:
          - operation_template: "般岳-普通攻击-焚身"
          - op_name: "设置状态"
            state_list: ["自定义-般岳-怒相"]

      # 非失衡期嗔火满150时也进入怒相（避免溢出）
      - states: "[般岳-嗔火]{145, 150}"
        debug_name: "嗔火即将溢出进入怒相"
        operations:
          - operation_template: "般岳-普通攻击-焚身"
          - op_name: "设置状态"
            state_list: ["自定义-般岳-怒相"]

      # ==================== 失衡期连招 ====================
      # 失衡期使用论道狮吼（秒均DPS高）
      - states: "[自定义-失衡时间, 0, 10] & [前台-特殊技可用]"
        debug_name: "失衡期论道狮吼"
        operations:
          - operation_template: "般岳-连招-论道狮吼"

      # ==================== 非失衡期连招 ====================
      # 非失衡期使用完整循环快速积攒嗔火
      - states: "[前台-特殊技可用]"
        debug_name: "完整循环积攒嗔火"
        operations:
          - operation_template: "般岳-连招-完整循环"

      # ==================== 默认普攻 ====================
      - states: ""
        debug_name: "默认峥嵘普攻"
        operations:
          - operation_template: "般岳-普通攻击-峥嵘"
