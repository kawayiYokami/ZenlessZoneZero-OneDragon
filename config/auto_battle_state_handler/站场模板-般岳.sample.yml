template_name: "站场模板-般岳"
# 般岳站场模板 - 基于操作指南重构
# ============================================
# 核心机制：
# - 嗔火(Wrathful Fires)：最大150点，≥120可进入怒相状态
# - 山威(Mountain's Might)：进入怒相获得4点，EX技能消耗山威而非能量
# - 怒相状态下无法获得嗔火！
# ============================================
# 快速输入指令（完美取消节点）：
# - 地动(ABA)：左手砸地时，完整耗时2.4s，最短取消1.2s
# - 山摇(BBA)：双手插入地板起跳时，完整耗时1.6s，最短取消0.8s
# - 论道(BAB)：左手伸到右上角时，完整耗时1.2s，最短取消0.6s
# - 狮子吼(AAB)：身子弯到底时，完整耗时1.0s，最短取消0.5s
# ============================================
# 连招策略：
# - 非失衡期：地动山摇(ABA→BBA)，总倍率1160.6%，耗时长但总倍率高
# - 失衡期：论道狮吼(BAB→AAB)，总倍率925.6%，秒均DPS高且耗时短
# - 怒相爆发：ABA→BBA→BAB→AAB→长按A(摧岳+倾山)，总倍率4582.8%
# ============================================
handlers:
  - states: "[前台-般岳]"
    interrupt_states: "[前台-能量, 0, 0.1] & ![前台-般岳]"
    sub_handlers:
      # ==================== 黄光处理 ====================
      # 黄光时优先考虑是否需要切人招架支援
      - states: "[自定义-黄光切人, 0, 1]"
        sub_handlers:
          # 有山威时：不动如山格挡，不切人继续站场
          - states: "[般岳-山威]{1, 4}"
            debug_name: "有山威黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 怒相状态下：不动如山格挡，继续站场输出
          - states: "[自定义-般岳-怒相, 0, 30]"
            debug_name: "怒相状态黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 嗔火满时：不动如山格挡，准备进入怒相
          - states: "[般岳-嗔火]{120, 150}"
            debug_name: "嗔火满黄光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
              - op_name: "清除状态"
                state_list: ["自定义-黄光切人"]
          # 嗔火未满且无山威：正常切人招架支援（回复4嗔火）
          - states: ""
            debug_name: "嗔火未满正常切人招架支援"
            operations:
              - operation_template: "般岳-招架支援-铁壁"

      # ==================== 红光闪避 ====================
      # 红光时根据状态选择闪避方式
      - states: "[自定义-红光闪避, 0, 1]"
        sub_handlers:
          # 有山威时：不动如山格挡
          - states: "[般岳-山威]{1, 4}"
            debug_name: "有山威红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 怒相状态下：不动如山格挡
          - states: "[自定义-般岳-怒相, 0, 30]"
            debug_name: "怒相状态红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 嗔火满时：不动如山格挡（完美格挡+6嗔火）
          - states: "[般岳-嗔火]{120, 150}"
            debug_name: "嗔火满红光不动如山"
            operations:
              - operation_template: "般岳-闪避-不动如山"
          # 嗔火未满：闪避反击扬砾（极限闪避+4嗔火，可衔接普攻第3段）
          - states: ""
            debug_name: "扬砾闪避反击"
            operations:
              - operation_template: "般岳-闪避反击-扬砾"

      # ==================== 连携换人 ====================
      - states: "[自定义-连携换人, 0, 0.5]"
        operations:
          - operation_template: "般岳-连携技-怒焰"

      # ==================== 切人后等待 ====================
      - states: "([按键-切换角色-下一个, 0, 0.3]|[按键-切换角色-上一个, 0, 0.3])"
        debug_name: "切人后等待"
        sub_handlers:
          - states: "[按键可用-快速支援, 0, 0.5]"
            operations:
              - op_name: "等待秒数"
                seconds: 0.5
          - states: ""
            operations:
              - op_name: "等待秒数"
                seconds: 0.3

      # ==================== 失衡期终结技 ====================
      # 失衡期间优先释放终结技（嗔火≥120时自动进入怒相）
      - states: "[自定义-失衡时间, 0, 10] & [般岳-终结技可用]"
        debug_name: "失衡期释放撼天动地"
        operations:
          - operation_template: "般岳-终结技-撼天动地"
          - op_name: "设置状态"
            state_list: ["自定义-般岳-怒相"]

      # ==================== 怒相爆发 ====================
      # 怒相状态下释放4EX+摧岳+倾山（搓招版，比自动挡多19.8%倍率）
      - states: "[自定义-般岳-怒相, 0, 30]"
        debug_name: "怒相爆发连招"
        operations:
          - operation_template: "般岳-连招-怒相爆发"

      # ==================== 进入怒相 ====================
      # 嗔火≥120时长按A发动焚身进入怒相
      # 站场模板：嗔火满即进入怒相，不等失衡
      - states: "[般岳-嗔火]{120, 150}"
        debug_name: "嗔火满进入怒相"
        operations:
          - operation_template: "般岳-普通攻击-焚身"
          - op_name: "设置状态"
            state_list: ["自定义-般岳-怒相"]

      # ==================== 失衡期连招 ====================
      # 失衡期使用论道狮吼（秒均DPS高，比地动山摇快约0.7秒）
      - states: "[自定义-失衡时间, 0, 10] & [前台-特殊技可用]"
        debug_name: "失衡期论道狮吼"
        operations:
          - operation_template: "般岳-连招-论道狮吼"

      # ==================== 非失衡期连招 ====================
      # 非失衡期使用地动山摇积攒嗔火（总倍率高，地动有1.2秒完美取消窗口）
      - states: "[前台-特殊技可用]"
        debug_name: "非失衡期地动山摇"
        operations:
          - operation_template: "般岳-连招-地动山摇"

      # ==================== 默认普攻 ====================
      # 普攻回复能量（进场自带60能量）
      - states: ""
        debug_name: "默认峥嵘普攻"
        operations:
          - operation_template: "般岳-普通攻击-峥嵘"
